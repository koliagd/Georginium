<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Джорджиниум | Фандом вселенной Джорджей</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        /* Остальные стили остаются без изменений */
        .tab, .tab:hover, .tab.active, .tab-content, .tab-content.active,
        .character-card, .character-card:hover, .map-container, .map-tooltip,
        .nav-link, .nav-link::after, .nav-link:hover::after, .nav-link.active::after,
        .floating, .pulse, .custom-george, .custom-george::after,
        .apple-logo, .apple-logo.jump {
            /* Все предыдущие стили остаются */
        }

        /* Стили для модальных окон */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            max-width: 90%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .modal-content h3 {
            margin-top: 0;
            text-align: center;
            color: #333;
        }
        .modal-content input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .modal-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }
        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }
        .auth-buttons button {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mr-4 shadow-lg apple-logo" id="appleLogo">
                        <i class="fas fa-apple-alt text-3xl text-purple-600"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">Джорджиниум</h1>
                        <p class="text-blue-100">Фандом вселенной Джорджей</p>
                    </div>
                </div>
                <div class="flex items-center">
                    <nav class="flex space-x-6">
                        <a href="#home" class="nav-link active text-white font-medium">Главная</a>
                        <a href="#all-georges" class="nav-link text-white font-medium">Все Джорджи</a>
                        <a href="epland.html" class="nav-link text-white font-medium">Эпланд</a>
                        <a id="createGeorgeLink" href="create_george.html" class="nav-link text-white font-medium hidden">Создать Джорджа</a>
                    </nav>
                    <div class="auth-buttons">
                        <button id="signUpButton" class="bg-green-500 hover:bg-green-600 text-white">Регистрация</button>
                        <button id="signInButton" class="bg-blue-500 hover:bg-blue-600 text-white">Вход</button>
                        <button id="signOutButton" class="bg-red-500 hover:bg-red-600 text-white hidden">Выйти</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Модальное окно для регистрации -->
    <div id="signUpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSignUp">&times;</span>
            <h3>Регистрация</h3>
            <input type="email" id="signupEmail" placeholder="Email" required>
            <input type="password" id="signupPassword" placeholder="Пароль" required>
            <div class="modal-buttons">
                <button id="confirmSignUp" class="bg-green-500 text-white">Зарегистрироваться</button>
                <button id="cancelSignUp" class="bg-gray-300">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для входа -->
    <div id="signInModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSignIn">&times;</span>
            <h3>Вход</h3>
            <input type="email" id="signinEmail" placeholder="Email" required>
            <input type="password" id="signinPassword" placeholder="Пароль" required>
            <div class="modal-buttons">
                <button id="confirmSignIn" class="bg-blue-500 text-white">Войти</button>
                <button id="cancelSignIn" class="bg-gray-300">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section id="home" class="py-16 bg-gradient-to-b from-blue-50 to-purple-50">
        <!-- Остальной контент остается без изменений -->
    </section>

    <!-- All Georges Section -->
    <section id="all-georges" class="py-16 bg-white">
        <!-- Остальной контент остается без изменений -->
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <!-- Остальной контент остается без изменений -->
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="fixed bottom-8 right-8 w-12 h-12 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-300 opacity-0 invisible hover:bg-purple-700">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // Инициализация Supabase
        const supabaseUrl = 'https://sjdjtmxnfxyxvvagxyur.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNqZGp0bXhuZnh5eHZ2YWd4eXVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5MDAwNDUsImV4cCI6MjA3MTQ3NjA0NX0.B05rnz9cgNH8BufYnBtJjuR4QcSBi9oBB17miCz9nnI';
        const { createClient } = supabase;
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Функции для работы с модальными окнами
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Очищаем поля при закрытии
            if (modalId === 'signUpModal') {
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
            } else if (modalId === 'signInModal') {
                document.getElementById('signinEmail').value = '';
                document.getElementById('signinPassword').value = '';
            }
        }

        // Проверка авторизации при загрузке страницы
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();

            if (user) {
                document.getElementById('signUpButton').classList.add('hidden');
                document.getElementById('signInButton').classList.add('hidden');
                document.getElementById('signOutButton').classList.remove('hidden');
                document.getElementById('createGeorgeLink').classList.remove('hidden');
                loadCustomGeorges(user.id);
            } else {
                document.getElementById('signUpButton').classList.remove('hidden');
                document.getElementById('signInButton').classList.remove('hidden');
                document.getElementById('signOutButton').classList.add('hidden');
                document.getElementById('createGeorgeLink').classList.add('hidden');
            }
        }

        // Регистрация
        document.getElementById('signUpButton').addEventListener('click', () => {
            openModal('signUpModal');
        });

        document.getElementById('confirmSignUp').addEventListener('click', async () => {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!email || !password) {
                alert('Пожалуйста, заполните все поля!');
                return;
            }

            const { data, error } = await supabase.auth.signUp({
                email: email,
                password: password,
            });

            if (error) {
                alert("Ошибка: " + error.message);
            } else {
                alert("Вы успешно зарегистрировались!");
                closeModal('signUpModal');
                checkAuth();
            }
        });

        document.getElementById('cancelSignUp').addEventListener('click', () => {
            closeModal('signUpModal');
        });

        document.getElementById('closeSignUp').addEventListener('click', () => {
            closeModal('signUpModal');
        });

        // Вход
        document.getElementById('signInButton').addEventListener('click', () => {
            openModal('signInModal');
        });

        document.getElementById('confirmSignIn').addEventListener('click', async () => {
            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;

            if (!email || !password) {
                alert('Пожалуйста, заполните все поля!');
                return;
            }

            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) {
                alert("Ошибка: " + error.message);
            } else {
                alert("Вы успешно вошли!");
                closeModal('signInModal');
                checkAuth();
            }
        });

        document.getElementById('cancelSignIn').addEventListener('click', () => {
            closeModal('signInModal');
        });

        document.getElementById('closeSignIn').addEventListener('click', () => {
            closeModal('signInModal');
        });

        // Выход
        document.getElementById('signOutButton').addEventListener('click', async () => {
            const { error } = await supabase.auth.signOut();
            if (error) {
                alert("Ошибка: " + error.message);
            } else {
                alert("Вы вышли из аккаунта.");
                checkAuth();
            }
        });

        // Загрузка созданных Джорджей
        async function loadCustomGeorges(userId) {
            const { data: georges, error } = await supabase
                .from('georges')
                .select('*')
                .eq('user_id', userId);

            if (error) {
                console.error("Ошибка загрузки Джорджей:", error);
                return;
            }

            const container = document.getElementById('customGeorgesContainer');
            container.innerHTML = '';

            georges.forEach(george => {
                const card = document.createElement('div');
                card.className = 'character-card bg-white rounded-xl overflow-hidden shadow-lg custom-george';
                card.innerHTML = `
                    <div class="bg-${george.color}-500 p-4 text-white text-center">
                        <h3 class="text-xl font-bold">${george.name}</h3>
                        <p class="text-${george.color}-100">${george.role || 'Житель Эпланда'}</p>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-center mb-4">
                            <div class="w-24 h-24 bg-${george.color}-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-5xl text-${george.color}-500"></i>
                            </div>
                        </div>
                        <div class="space-y-3">
                            ${george.age ? `<div><h4 class="font-bold text-gray-700">Возраст:</h4><p class="text-gray-600">${george.age}</p></div>` : ''}
                            ${george.likes ? `<div><h4 class="font-bold text-gray-700">Любит:</h4><p class="text-gray-600 flex items-center"><i class="fas fa-heart text-red-500 mr-2"></i> ${george.likes}</p></div>` : ''}
                            ${george.fears ? `<div><h4 class="font-bold text-gray-700">Боится:</h4><p class="text-gray-600 flex items-center"><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i> ${george.fears}</p></div>` : ''}
                            ${george.iq ? `<div><h4 class="font-bold text-gray-700">IQ:</h4><p class="text-gray-600 flex items-center"><i class="fas fa-brain text-${george.color}-500 mr-2"></i> ${george.iq}</p></div>` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Apple logo jump
        const appleLogo = document.getElementById('appleLogo');
        appleLogo.addEventListener('click', () => {
            appleLogo.classList.add('jump');
            setTimeout(() => {
                appleLogo.classList.remove('jump');
            }, 500);
        });

        // Back to top button
        const backToTopButton = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.remove('opacity-0', 'invisible');
                backToTopButton.classList.add('opacity-100', 'visible');
            } else {
                backToTopButton.classList.remove('opacity-100', 'visible');
                backToTopButton.classList.add('opacity-0', 'invisible');
            }
        });

        backToTopButton.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Поиск и фильтрация
        const searchInput = document.getElementById('searchGeorge');
        const filterAll = document.getElementById('filterAll');
        const filterOfficial = document.getElementById('filterOfficial');
        const filterCustom = document.getElementById('filterCustom');

        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase();
            document.querySelectorAll('.character-card').forEach(card => {
                const cardName = card.querySelector('h3').textContent.toLowerCase();
                if (cardName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        filterAll.addEventListener('click', () => {
            document.querySelectorAll('.character-card').forEach(card => {
                card.style.display = 'block';
            });
        });

        filterOfficial.addEventListener('click', () => {
            document.querySelectorAll('.character-card').forEach(card => {
                if (card.classList.contains('custom-george')) {
                    card.style.display = 'none';
                } else {
                    card.style.display = 'block';
                }
            });
        });

        filterCustom.addEventListener('click', () => {
            document.querySelectorAll('.character-card').forEach(card => {
                if (card.classList.contains('custom-george')) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Проверка авторизации при загрузке страницы
        checkAuth();
    </script>
</body>
</html>
